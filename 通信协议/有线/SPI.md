# 通信原理
SPI 总线在默认情况下按照先传输高位（MSB，Most Significant Bit），然后传输低位（LSB，Least Significant Bit）的顺序进行数据传输。当数据线为高电平时表示逻辑 1，当数据线为低电平时表示逻辑 0，且无需应答信号，每个字节传输完后可立即传输下一个字节。

SPI 总线的主设备和从设备中都有一个移位寄存器，主设备通过向移位寄存器写入一个字节来发起一次数据传输，如图 179.3 所示。

![[Pasted image 20250826104709.webp]]

当 SPI 主设备想读/写从设备时，它首先要拉低要进行通信的从设备对应的 CS 线（CS 线是低电平有效），接着开始发送时钟脉冲到时钟线上，在相应的脉冲时间上，主设备把信号发送到 MOSI 线实现“写”，同时可对 MISO 线采样实现“读”，即全双工通信。

## 例如
例如主设备发送 0x00，从设备中当前内容为 0xFF，每个时钟周期内主设备和从设备移位寄存器中的数据如表 179.1 所示。
![[Pasted image 20250826105031.webp]]

根据表 179.1 可以得到 SPI 中数据传输实际上是主设备和从设备之间进行数据交换，在一个 SPI 时钟周期内，收发是同时进行的，主机通过 MOSI 线发送 1bit 数据，从机通过该线读取这 1bit 数据；从机通过 MISO 线发送 1bit 数据，主机通过该线读取这 1bit 数据；当移位寄存器中的内容全部移出时，相当于完成了俩个移位寄存器数据的交换。

==如果主设备要给从设备传输数据，主设备只需要忽略掉从设备接收到的数据即可。如果主设备要从从设备接收数据，主设备向从设备随机发送数据，从设备忽略掉从主设备接收的数据即可。==

# 工作模式
## 时钟极性（CPOL）和相位（CPHA）
> polarity和phase

根据 SPI 总线中的时钟极性（CPOL）和相位（CPHA）两个参数可以设置 4 种 SPI 总线工作模式，其中 CPOL 定义了时钟线空闲状态时电平，时钟线为低电平时用 0 表示，时钟线为高电平时用 1 表示。CPHA 定义了数据采样边沿，第一个边沿采用用 0 表示，第二个边沿采用用 1表示。因此 CPOL 和 CPHA 两者可以组合成以下 4 种模式。
### (1) CPOL=0,CPHA=0
表示时钟线空闲时为低电平，数据在时钟的第一个边沿(上升沿)被采样，时序如图 179.4所示。
### (2) CPOL=0,CPHA=0
### (3) CPOL=0,CPHA=0
### (4) CPOL=0,CPHA=0
